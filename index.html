<!DOCTYPE html>
<html style=" width: 100%;height: 100%">
<head>
    <meta charset="utf-8">
    <title>别踩白块</title>
    <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <style type="text/css">
	*{margin: 0px;padding: 0px;box-sizing: border-box;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}
	#gameZone{width: 100%;height:100%; margin: auto 0px;position: absolute;overflow: hidden;}
	.square{width: 160px;height: 189px;float: left;}
	.squareBlack{background: black;position: absolute;z-index: 0;}
    .container{position: absolute;width: 100%;height: 100%;display: none;-webkit-user-select: none;-moz-user-select: none}
    .bg{position: absolute;width: 100%;height: 100%;}
    .DiBan{position: absolute; width: 100%;height: 100%;}
    .jianbian{width: 160px;height: 189px;float: left;background: silver;opacity:0.4;}
    .wenzi{position: absolute;color: #f8635d;text-align: center;width: 100%;pointer-events:none}
    .djhk{position: absolute;display: inline-block;text-align:center; width:80%;border-radius: 25px;height: 10%;background-color: white;color:dodgerblue;pointer-events:none}
    .hei{position: absolute;background:#308fe6}
	.xian{width:1px;background: #64EFED;position: absolute;top: 0px;left: 50%;pointer-events:none}
	.yuan{border-radius: 50%;border: 2px #64EFED solid;box-shadow: 0px 0px 15px #888888;position: absolute;pointer-events:none}
	
	.wei{width: 100%;height:100%;overflow: hidden ;position: absolute;}
	.p{color: #546D7D;} 
	.btn{width:50%; height: 70px; background:#38ABE6;font-size: 50px;line-height: 70px;border-radius:20px;outline:0 none ;color: #fff;} 
	
	.roundedRectangle{z-index: 999; margin:  0px auto;position: absolute;top: 20%;left: 0;right: 0;bottom: 0;height: 60%;width: 80%;overflow: hidden;background: #ffffff;border-radius: 25px;display: none;}
	.roundedRectangle1{z-index: 999; margin:  0px auto;position: absolute;left: 0;right: 0;bottom:5%;height: 50%;width: 80%;overflow: hidden;background: #ffffff;border-radius: 25px;display: none;text-align: center;}
	.btn1{width:80%; height: 25%; background:#38ABE6;border-radius:20px;outline:0 none ;color: #fff;position: absolute;bottom: 5%;} 
  	.styimg{height: 100%;}
	</style>
	
	<script>
	    function getScript(e, i) { var n = document.createElement("script"); n.type = "text/ ​javascript​", n.async = !0, i && (n.onload = i), n.src = e, document.head.appendChild(n) }
	    function parseMessage(e) { var i = e.data, n = i.indexOf(DOLLAR_PREFIX + RECEIVE_MSG_PREFIX); if (-1 !== n) { var t = i.slice(n + 2); return getMessageParams(t) } return {} }
	    function getMessageParams(e) { var i, n = [], t = e.split("/"), a = t.length; if (-1 === e.indexOf(RECEIVE_MSG_PREFIX)) { if (a >= 2 && a % 2 === 0) for (i = 0; a > i; i += 2)n[t[i]] = t.length < i + 1 ? null : decodeURIComponent(t[i + 1]) } else { var o = e.split(RECEIVE_MSG_PREFIX); void 0 !== o[1] && (n = JSON && JSON.parse(o[1])) } return n }
	    function getDapi(e) { var i = parseMessage(e); if (!i || i.name === GET_DAPI_URL_MSG_NAME) { var n = i.data; getScript(n, onDapiReceived) } }
	    function invokeDapiListeners() { for (var e in dapiEventsPool) dapiEventsPool.hasOwnProperty(e) && dapi.addEventListener(e, dapiEventsPool[e]) }
	    function onDapiReceived() { dapi = window.dapi, window.removeEventListener("message", getDapi), invokeDapiListeners() }
	    function init() { window.dapi.isDemoDapi && (window.parent.postMessage(DOLLAR_PREFIX + SEND_MSG_PREFIX + JSON.stringify({ state: "getDapiUrl" }), "*"), window.addEventListener("message", getDapi, !1)) } var DOLLAR_PREFIX = "$$", RECEIVE_MSG_PREFIX = "DAPI_SERVICE:", SEND_MSG_PREFIX = "DAPI_AD:", GET_DAPI_URL_MSG_NAME = "connection.getDapiUrl", dapiEventsPool = {}, dapi = window.dapi || { isReady: function () { return !1 }, addEventListener: function (e, i) { dapiEventsPool[e] = i }, removeEventListener: function (e) { deletedapiEventsPool[e] }, isDemoDapi: !0 };
	    init();
	</script>
</head>

<body>
    <div class="DiBan" id="DiBan"></div>
    <audio id="bgmp3" src= "bgmusic.mp3" preload muted="muted"></audio>
   	<!--加载页面-->
    <div style="width: 100%;height: 100%;background-color: #000000;position: absolute;" id="load_ing"><img src="spinner4.gif" style="position: absolute;top: 50%;left: 50%;margin-top: -22.5px;margin-left: -22.5px;"/></div>
    <div class="container" id="container">
    	<img src="bg.jpg" style="width: 100%;height: 100%;z-index: -1;position: absolute;" />
        <div class="wenzi" id="wenzi">0</div>
        <div class="wenzi" id="gaof">高分：100</div>
        <button id="install" style="position: absolute; background-color: #f5c30b;width: 95px;font-size: 17px;line-height: 35px;font-weight: 500; height: 35px;z-index: 9999;outline:0 none ;border-radius: 20px;color: #ab7333;top: 20px;left: 20px;">现在安装</button>
        
        <div id="bg2" style="display:block;background-color: #000;width: 100%;position:absolute;height: 100%;opacity: 0.5;pointer-events:none;z-index: 2; "></div>
        <div id="gameZone" >
            <img class="bg" id="beig" src="timg.jpg">
            <div id="tishi" style="width: 100%;height: 100%;position:absolute;">
            	<img src="shou.png" style="position: absolute;z-index: 111;pointer-events:none;" id="shou"/>
				<div id="djhk" class="djhk"><span id="djwz">点击黑色方块</span></div>
				<div id="heikuai" style="width: 160px;height: 189px;background: black;position: absolute;z-index: 3;text-align: center;color: #fff">开始</div>
    		</div>
    		
			<div id="boardb" style="position: absolute;top: 0px;width: 100%;height: 100%;"></div>
			<!--游戏中途结束-->
			<div class="roundedRectangle" id="out">
				<div id="toptxt" style="background-color: #00BFFF;height: 15%;padding: 0px;margin: 0px;vertical-align: middle; color: white;text-align: center;">马上就到了!</div>
				<div style="margin:  0px auto;position: absolute;top: 16%;left: 0;right: 0;color: #555555; text-align: center">还需要<span style="color: #f01b19" id="num">99</span>个</div>
				<div style="position: absolute;top: 30%;height:20%;" id="imgbox"><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /></div>
				<div id = "again" style="margin:  0px auto;position: absolute;top: 50%;left: 0;right: 0;width:80%;height:18%;background: #00BFFF;border-radius: 25px; color: white;text-align: center;">再试一次</div>
				<div id = "con" style="margin:  0px auto;position: absolute;top: 73%;left: 0;right: 0;width:80%;height:18%;background: #00BFFF;border-radius: 25px; color: white;text-align: center;">继续</div>
			</div>
			<!--点了再来一次之后中途结束-->
			<div class="roundedRectangle1" id="agover">
				<div id="toptxt" style="background-color: #00BFFF;height: 20%;padding: 0px;margin: 0px;vertical-align: middle; color: white;text-align: center;">马上就到了!</div>
				<div style="margin:  0px auto;position: absolute;top: 16%;left: 0;right: 0;color: #555555; text-align: center">还需要<span style="color: #f01b19" id="ovnum">99</span>个</div>
				<div style="position: absolute;top: 30%;height:20%;width: 100%;" ><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /></div>
				<button class="btn1" id="btn_zsyc">再试一次</button>
			</div>
			<img src="bcbk.png" style="position: absolute;z-index: 999;display: none;" id="bcbk_ag"/>
		</div>
		<!--游戏最后结束-->
		<div class="wei" style="z-index: 999;display: none;text-align: center;" id="popover">
			<div style="background: #FFFFFF;width: 100%;height: 65%;position: absolute;" id="popwz">
				<p class="p">干的漂亮！</p >
				<p class="p">准备好开始下一首歌了吗？</p >
				<button class="btn" id="btnjx">继续</button>
			</div>
			<div style="position: absolute;top: 20%;height:13%;width: 100%;" id="overimg"><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /><img class="styimg" src="huangguan.png"  /></div>
			<div id="sc" style="color: #FFFFFF;width: 100%;position: absolute;">0</div>
			<img src="bcbk.png" style="position: absolute;" id="bcbk"/>
		</div>
		
		
		
	</div>
	
	
<script type="text/javascript">
//	console.log(document.getElementById('bgmp3').autoplay)
	
	var load_ing = document.getElementById('load_ing');//加载页面
	var container = document.getElementById("container");//最外层的div容器
	var sfxz = true;
	window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", hengshuping, false);
    
    function hengshuping() {
        if (window.orientation == 0 || window.orientation == 180) {
               	if(sfxz){
               		window.location.reload();
               		sfxz = false;
               	}
            }
            else if (window.orientation == 90 || window.orientation == -90) {
                if(sfxz){
               		window.location.reload();
               		sfxz = false;
               	}
            }
       }
	window.ontouchstart  = function(e) { e.preventDefault(); };
	window.onload = function(){
		(dapi.isReady()) ? onReadyCallback() : dapi.addEventListener('ready',onReadyCallback);
		
		load_ing.style.display = 'none';
		container.style.display = 'block';
		var bgmc = document.getElementById('bgmp3');
		bgmc.pause();
		
		init();
	}
//		console.log(bgmc)
//		if(bgmc.paused){
//			bgmc.play();
//		}
//		bgmc.muted = false;
		
	    var mql = window.matchMedia('(orientation: portrait)')//检查是否是竖屏
	    var install = document.getElementById('install');//安装
	    var backGround = document.getElementById("beig");//获取背景
	    var gameZone = document.getElementById('gameZone');
	    var DIBAN = document.getElementById("DiBan");
	    var bgmc = document.getElementById('bgmp3');
	    var originalWidth = 640;//设计宽度
	    var originalHeight = 1136;//设计高度
	    var zoomFactor = 1;//缩放系数
	    var topEdging = 0;//上方白边距离
	    var leftEdging = 0;//左方白边距离
	    var gameSceneHeight = 600;//游戏场景设计高度
	    var wz = document.getElementById('wenzi');//积分文字
	    var gaof = document.getElementById('gaof');
	    var heikuai = document.getElementById('heikuai');//初始页面的黑块
	    var shou = document.getElementById('shou');//手指
	    var moc = document.getElementById('bg2');//初始半透明蒙层
	    var tishi = document.getElementById('tishi');
	//  var kaishi = document.getElementById('kaishi');
	    var djhk = document.getElementById('djhk');
	    var djwz = document.getElementById('djwz');
	    var loc = DIBAN.offsetHeight;//黑块落地失败判定
	    console.log(DIBAN.offsetHeight)
	    var count = 0;//点击总数
	    var li = "boardb";
	    var locArr = [];
	    var hkArr = [];
	    var inittimer = null;
	    var speed = 20;
	    var isdayu = false;
	    var isHS = true;
	    var isonceagin = false;//是否点过再来一次
	    
	    var popover = document.getElementById('popover');//大于一百分时的游戏结束弹窗
	    var popwz = document.getElementById('popwz');//结束页的文字部分
	    var cgt = false;//是否出现长条
	    
		var out = document.getElementById('out');
		var arr_left = [gameZone.offsetWidth/4,(gameZone.offsetWidth/4)*2,(gameZone.offsetWidth/4)*3,0];
		
		
	
	    // screenRotation();//检查屏幕横竖屏并旋转(屏幕适配)
	//  calculation_WidthAndHeight_Proportion()//计算宽高比
	    
	//	gameout();
		
		function init() {
			install.addEventListener('touchstart',userClickedDownloadButton);
	        // gameZone.style.height = gameSceneHeight * zoomFactor + 'px';
	        if (mql.matches) {
	        	isHS = true;
	            gameZone.style.width = '100%';
	             if(gameZone.offsetWidth>640){
	            	gameZone.style.width = '640px';
	            	gameZone.style.marginLeft = container.offsetWidth/2-640/2+'px';
	            }
	            gameZone.style.height = '100%';
	            wz.style.fontSize = gameZone.offsetHeight/12+'px';
	            gaof.style.fontSize = gameZone.offsetHeight/17+'px';
	            wz.style.zIndex = 2;
	            gaof.style.zIndex = 2;
	            gaof.style.top = wz.offsetHeight+'px';
	           	arr_left = [gameZone.offsetWidth/4,(gameZone.offsetWidth/4)*2,(gameZone.offsetWidth/4)*3,0];
	        	inittishi();
	        } else {
	        	isHS = false;
	            gameZone.style.width = '50%';
	            gameZone.style.height = '100%';
	            gameZone.style.bottom = '0px';
	            gameZone.style.left = DIBAN.offsetWidth/2-gameZone.offsetWidth/2+'px';
	            if(gameZone.offsetHeight>640){
	            	isdayu = true;
	            }
	            initheng();
	            arr_left = [gameZone.offsetWidth/4,(gameZone.offsetWidth/4)*2,(gameZone.offsetWidth/4)*3,0];
	        }
			finger();
	        for(i=0;i<3;i++){
	        	var jl = gameZone.offsetWidth/4;
	        	var xian=document.createElement('span');
	        	xian.style.width = '1px';
	        	xian.style.height = gameZone.offsetHeight+'px';
	        	xian.style.position = 'absolute';
	        	xian.style.left = jl*(i+1)+'px';
	        	xian.style.backgroundColor = '#FFFFFF';
	        	xian.style.zIndex = 1;
	        	gameZone.appendChild(xian);
	        }
	    }
		
		//初始提示页面(横屏)
		function initheng(){
			wz.style.fontSize = gameZone.offsetWidth/7+'px';
			wz.style.top = DiBan.offsetHeight*0.2+'px';
			wz.style.left = '0px';
			wz.style.width = '25%';
			gaof.style.fontSize = gameZone.offsetWidth/14+'px';
			gaof.style.left = '0px';
			gaof.style.width = '25%';
			gaof.style.top = DiBan.offsetHeight*0.2+wz.offsetHeight+'px';
			
			tishi.style.top = '0px';
	        tishi.style.zIndex = 2;
	        heikuai.style.bottom = "0px";
	        heikuai.style.width = gameZone.offsetWidth/4+'px';  
	        heikuai.style.height = gameZone.offsetHeight/3+'px';
	        if(isdayu){
	        	heikuai.style.height = gameZone.offsetHeight/4+'px';
	        }
	        heikuai.style.left = gameZone.offsetWidth/4* 2 + 'px';
	        heikuai.style.fontSize = gameZone.offsetWidth/4/3+'px';
	        heikuai.style.lineHeight= heikuai.offsetHeight+'px';
	        
	        djhk.style.height = gameZone.offsetHeight*0.2+'px';
	        if(isdayu){
	        	djhk.style.height = gameZone.offsetHeight*0.1+'px';
	        }
	        djhk.style.width = gameZone.offsetWidth*0.8+'px';
	        djhk.style.top = '20px';
	        djhk.style.left = tishi.offsetWidth/2-djhk.offsetWidth/2+'px';
	        djwz.style.fontSize = djhk.offsetHeight/2+'px';
	        djwz.style.lineHeight = djhk.offsetHeight+'px';
	        document.body.addEventListener('touchstart',touchbody);
		}
		
		
	    //初始提示页面
	    function inittishi() {
	        tishi.style.top = '0px';
	        tishi.style.zIndex = 2;
	        heikuai.style.bottom = "0px";
	        heikuai.style.width = gameZone.offsetWidth/4+'px';
	        heikuai.style.height = gameZone.offsetHeight/5+'px';
	        heikuai.style.left = gameZone.offsetWidth/4* 2 + 'px';
	        heikuai.style.fontSize = gameZone.offsetWidth/4/3+'px';
	        heikuai.style.lineHeight= heikuai.offsetHeight+'px';
	        
	        djhk.style.top = tishi.offsetHeight/2-djhk.offsetHeight/2+'px';
	        djhk.style.left = tishi.offsetWidth/2-djhk.offsetWidth/2+'px';
	        djwz.style.fontSize = djhk.offsetHeight/2+'px';
	        djwz.style.lineHeight = djhk.offsetHeight+'px';
	        document.body.addEventListener('touchstart',touchbody);
	    }
	    
	    var fin_tim = null;
	    //手指动画
	    function finger(){
	    	shou.style.width = heikuai.offsetWidth+'px';
	    	shou.style.bottom = heikuai.offsetHeight+'px';
	    	shou.style.left = parseInt(heikuai.style.left)+heikuai.offsetWidth+'px';
	    	var current = -0;//旋转角度
	    	var fin_lf = parseInt(heikuai.style.left)+heikuai.offsetWidth/2;
	    	var fin_bot = heikuai.offsetHeight;
	    	var wait = 0;
	    	var sss = true;
	    	var bbb = true;
	    	fin_tim = setInterval(()=>{
	    		if(bbb){
	    			if(sss){
		    			current-=0.5;
			    		fin_lf-=0.2;
			    		fin_bot-=0.3;
			    		
		    		}else if(sss==false){
		    			current+=0.5;
			    		fin_lf+=0.2;
			    		fin_bot+=0.3;
		    		}
		    		shou.style.bottom = fin_bot+'px';
			    	shou.style.left = fin_lf+'px';
			    	shou.style.transform  = 'rotate('+current+'deg)';
	    		}
//	    		console.log(current)
	    		if(current<=-40&& sss == true || current>=0 && sss==false){
	    			bbb = false;
	    			wait++;
	    			if(wait==120){
	    				wait=0;
	    				sss = !sss;
	    				bbb = true;
//	    				current = 0;
//		    			fin_lf = parseInt(heikuai.style.left)+heikuai.offsetWidth/2;
//		   				fin_bot = heikuai.offsetHeight;
	    			}
	    		}
	    	},10);
	    }
		//再来一局清空所有东西
		function removeEvery(){
	        locArr = [];
	   		hkArr = [];
	   		count = 0;
	   		li = "boardb";
	   		speed = 20;
	   		wz.innerText = 0;
	   		loc = gameZone.offsetHeight;
	   		var boardb = document.getElementById('boardb');
	   		var boarda =document.getElementById('boarda');
	   		boardb.parentElement.removeChild(boardb);
	   		boarda.parentElement.removeChild(boarda);
	   		boardb = null;
	   		boarda = null;
		}
		
		//游戏失败弹出的框
		function gameout(){
			out.style.display = 'block';
			if(isHS){
				out.style.width = '80%';
			}else{
				out.style.width = '60%';
			}
	   		var over_img = document.getElementById('overimg').children;//图片
	   		for(i=0;i<overimg.length;i++){
	   			over_img[i].style.width = over_img[i].offsetHeight+'px';
	   		}
			out.style.fontSize = out.offsetHeight*0.2/2+'px';
			var toptxt = document.getElementById("toptxt");
		  	var again = document.getElementById("again");
		  	var con = document.getElementById("con");
			toptxt.style.lineHeight = toptxt.offsetHeight+'px';
			again.style.lineHeight = again.offsetHeight+'px';
	
			con.style.lineHeight = con.offsetHeight+'px';
			var imgbox = document.getElementById('imgbox');
			imgbox.style.left = (out.offsetWidth-imgbox.offsetWidth)/2 + 'px';
			out.style.top = -out.offsetHeight+'px';
			var num = document.getElementById('num');
			num.innerText = 100-count;
			var out_top = -out.offsetHeight;
			var out_tf = true;
			var tck = setInterval(()=>{
				if(out_tf){
					out_top+=15;
				}else{
					out_top-=15;
				}
				if(out_top+out.offsetHeight >= out.parentElement.offsetHeight){
					out_tf = false;
				}
				if(out_top+(out.offsetHeight/2)<=out.parentElement.offsetHeight/2 && !out_tf){
					clearTimeout(tck);
					again.addEventListener("touchstart",onceagain);
					con.addEventListener('touchstart',userClickedDownloadButton);
				}
				out.style.top = out_top+'px';
				
			},10);
			
		}
		
		//再来一局
		function onceagain(e){
			window.event? window.event.cancelBubble = true : e.stopPropagation();
	//		console.log('再来一局')
			isonceagin = true;
			removeEvery();
			out.style.display = 'none';
			drawBoard();
			var board = document.createElement('div');
	        board.setAttribute('id', 'boardb');
	        board.style.position = "absolute";
	        board.style.width = '100%';
	        board.style.height = '100%';
	        board.style.top = '0px';
	        gameZone.appendChild(board); 
	        timer = setInterval(fall, speed);
	        bgmc.currentTime = 0;
	        bgmc.play();
	        document.body.addEventListener('touchstart',touchbody);
		}
	
	    
	    var start = true;
	    var once = true;
	    //点击事件响应函数
	    function touchbody(e){
	    	console.log(e.target.id);
	//  	console.log(e.path)
			window.event? window.event.cancelBubble = true : e.stopPropagation();
	    	if(start && e.path[0].id == 'heikuai' ){
	    		start = false;
	    		
    			bgmc.currentTime = 0;
    			bgmc.muted = false;
    			bgmc.play();
	    			
	    		touchhk(e.path[0]);
	    		
	    	}else if( (e.path[0].id).indexOf('hei')!=-1 ){
	//  		console.log(e.path[0])
	    		judge(e.path[0]);
	    		if(tishi.parentElement){
					tishi.parentElement.removeChild(tishi);
				}
	    	}else if( (e.path[0].id).indexOf('chang')!=-1 && once){
	    		once = false;
	    		tcchang();
	    	}else{
	    		if(!start){
	//  			console.log(e.path[0])
	    			judge(e.path[0]);
	    		}
	//  		if(tishi.parentElement){
	//				tishi.parentElement.removeChild(tishi);
	//			}
	    	}
	    }
	    
	    
		//点击开始响应事件
	    function touchhk(obj) {
	    	clearTimeout(fin_tim);
	    	tishi.style.pointerEvents = 'none';
	    	shou.style.display = 'none';
	    	
	    	jsq(obj);
	    	count += 1;
	    	wz.innerText = count;
	        drawBoard();
	        timer = setInterval(fall, speed);
	        inittimer = setInterval(gundong, speed);
	    }
	    
	    //让提示文字隐藏
	    function jsq(obj){
			var hk = document.createElement('div');
			obj.appendChild(hk);
			hk.style.position = 'absolute';
			hk.style.width = obj.offsetWidth-10 +'px';
			hk.style.height = obj.offsetHeight-10+'px';
			hk.style.left = '5px';
			hk.style.top = '5px';
			hk.style.background = 'silver';
			hk.style.opacity = '0.4';
			var i = 10;
			var j=5;
			var op = 1;
			var ss = setInterval(()=>{
				i-=2;
				op-=0.15
				j--;
				hk.style.width = obj.offsetWidth-i +'px';
				hk.style.height = obj.offsetHeight-i+'px';
				hk.style.left = j+'px';
				hk.style.top = j+'px';
				obj.style.opacity = op;
				if(j == 0){
	//				tishi.removeChild(djhk);
					clearInterval(ss);
//					console.log(obj);
					obj.style.background = 'silver';
//					
					if(obj.id == 'heikuai'){
						xianshi();
					}
					
				}
			},30);
			
		}
	    var tis_zd = document.createElement('div');
	    //点击开始之后显示得小框
	    function xianshi(){
	   		tis_zd.setAttribute('class','djhk');
	   		tis_zd.style.height = djhk.offsetHeight+'px';
	   		tis_zd.style.width = djhk.offsetWidth+'px';
	   		tis_zd.style.top = djhk.offsetTop+'px';
	        tis_zd.style.left = tishi.offsetWidth/2-djhk.offsetWidth/2+'px';
	        tishi.appendChild(tis_zd);
	        tis_zd.innerText = '你还能再得99个吗？';
	        tis_zd.style.lineHeight = tis_zd.offsetHeight+'px';
	    	var tm = 0;
	    	tis_zd.style.fontSize = djhk.offsetWidth/12+'px';
	    	tis_zd.style.opacity = 0;
	    	tis_zd.style.zIndex = 999;
			var xs = setInterval(()=>{
	    		tm+=0.01;
	//  		console.log(tm);
	    		tis_zd.style.opacity = tm;
	    		if(tm>=1){
	//  			djhk.style.opacity = 1;
	    			clearInterval(xs);
	    		}
	    	},2);	
	    	
	    }
	    
	    
	    var tishitop = 0;
	    var opa = 0.5;
	    //让开始小框滚动
	    function gundong() {
	        opa-=0.03;
	        if(opa<=0){
	        	opa=0;
	        }
	        moc.style.opacity = opa;
	        djhk.style.opacity = opa;
	        tishitop -= 5;
	        heikuai.style.bottom = tishitop + 'px';
	        if (tishitop <= -heikuai.offsetHeight) {
	//          gameZone.removeChild(tishi);
	//          tishi = null;
	            clearTimeout(inittimer);
	        }
	    }
	
		
		//获取随机数
	    function rd(n, m) {
	        var c;
	        if (n > m) {
	            c = n - m + 1;
	            return Math.floor(Math.random() * c + m);
	        } else {
	            c = m - n + 1;
	            return Math.floor(Math.random() * c + n);
	        }
	
	    }
	
	
	    //使每次创建的大框的ID不一样
	    function order() {
	        if (li == 'boarda') {
	            li = 'boardb';
	        } else {
	            li = 'boarda';
	        }
	        return li;
	    }
	    //用闭包函数使每次创建的大框的ID不一样
	    // var order = (function () {
	    //     var li = "boardb";
	    //     return function () {
	    //         if (li == 'boarda') li = 'boardb';
	    //         else li = 'boarda';
	    //         return li;
	    //     }
	    // })()
	
	    //每次点击判定结果
	    function judge(obj) {
	        var num = obj.id.substr(3)
	        if (count != 0 && count % 30 == 0) {
	            clearTimeout(timer);
	            cgt = true;
	            speed-=2;
	            timer = setInterval(fall, speed);
	        }
	        if (num != locArr.pop()) {
	            clearTimeout(timer);
	            redk();
	            tis_zd.style.display = 'none';
	            //移除点击监听
	        	document.body.removeEventListener('touchstart',touchbody);
	        	//停止音乐
	        	bgmc.pause();
	            return;
	        } else {
	        	hkArr.pop();
	            loc += obj.offsetHeight;
	            jsq(obj);
	            count += 1;
	            wz.innerText = count;
	        }
	        if(count>=100){
	//      	console.log('加载结束页面');
	        	GameOver();
	        	xiaoshi();
	        	clearTimeout(timer);
	        	//停止音乐
	        	bgmc.pause();
	        	wz.style.display = 'none';
	        	gaof.style.display = 'none';
	        	tis_zd.style.display = 'none';
	        	//移除点击监听
	        	document.body.removeEventListener('touchstart',touchbody);
	        	
	        }
	        
	    }
	//  GameOver();
	    //大于100分后显示结束画面
	    function GameOver(){
	    	install.style.display = 'none';
	    	moctim();
	    	var sc = document.getElementById('sc');//最后得分
	    	sc.style.display = 'none';
	    	var overimg = document.getElementById('overimg');
			overimg.style.opacity = 0;
	   		for(i=0;i<overimg.children.length;i++){
	   			if(isHS){
	   				overimg.children[i].style.width = gameZone.offsetHeight*0.12+'px'
	   			}else{
	   				overimg.children[i].style.width = gameZone.offsetHeight*0.2+'px';
	   				overimg.children[i].style.height = gameZone.offsetHeight*0.2+'px';
	   			}
	   			
	   		}
	    	popover.style.height = "100%";
	    	popover.style.width = "100%";
	    	popover.style.position = 'absolute';
	    	popover.style.top = popover.parentElement.offsetHeight+'px';
	    	popover.style.display = 'block';
	    	var popT = parseInt(popover.style.top) ;
	    	
	    	var poptm = setInterval(()=>{
	    		popT-=10;
	    		popover.style.top = popT+'px';
	    		if(popT<=0){
	    			popT=0;
	    			popover.style.top = popT+'px';
	    			clearTimeout(poptm);
	    			sc.style.display = 'block';
	    			overimg.style.opacity = 1;
	    			for(i=0;i<overimg.children.length;i++){
	    				overimg.children[i].style.opacity = 0;
	    			}
	    			var imgx = 0;
	    			var imgo = 0;
	    			var imgTm = setInterval(()=>{
	    				imgo+=0.02;
	    				overimg.children[imgx].style.opacity = imgo;
	    				if(imgo>=1){
	    					overimg.children[imgx].style.opacity = 1;
	    					imgx++;
	    					imgo = 0;
	    				}
	    				if(imgx==overimg.children.length){
	    					clearTimeout(imgTm);
	    				}
	    			},10)
	    		}
	    	},10);
	    	var bcbk = document.getElementById('bcbk');
			var popch = popwz.children;
			if(isHS){
				popwz.style.top = popwz.parentElement.offsetHeight/2+'px';
				popch[0].style.fontSize = popwz.offsetWidth/9+'px';
				popch[1].style.fontSize = popwz.offsetWidth/14+'px';
				bcbk.style.width = bcbk.style.height = gameZone.offsetWidth*0.35+'px';
				bcbk.style.top = '15px'
				bcbk.style.left = container.offsetWidth/2-bcbk.offsetWidth/2+'px';
				
				overimg.style.top = bcbk.offsetHeight+15+'px';
			}else{
				popwz.style.top = popwz.parentElement.offsetHeight*0.35+'px';
				popch[0].style.fontSize = popwz.offsetHeight/6+'px';
				popch[1].style.fontSize = popwz.offsetHeight/9+'px';
				overimg.style.height = gameZone.offsetHeight*0.2+'px';
				overimg.style.top = '0px';
				bcbk.style.width = bcbk.style.height = gameZone.offsetHeight*0.35+'px';
				bcbk.style.top = gameZone.offsetHeight*0.1+'px';
				bcbk.style.left = gameZone.offsetWidth*0.1+'px';
			}
			popch[0].style.paddingTop = popwz.offsetHeight/8+'px';
			popch[1].style.paddingBottom = popwz.offsetHeight/12+'px';
			sc.style.top = overimg.offsetTop+overimg.offsetHeight+'px';
			sc.style.fontSize = overimg.offsetHeight/2+'px';
			sc.innerText = count;
			
			var btnjx = document.getElementById('btnjx');
			btnjx.addEventListener('touchstart',userClickedDownloadButton);
			
	    }
	    
	    //让蒙层慢慢显示出来
	    function moctim(){
	    	var opc = 0;
	    	var mct = setInterval(()=>{
	    		opc+=0.02
	    		moc.style.opacity = opc;
	    		if(opc>=0.5){
	    			clearTimeout(mct);
	    		}
	    	},100)
	    }
	
	    //产生大框中小黑框位置的随机数
	//  function generateRand() {
	//      var numArr = [];
	//      for (var j = 0; j < 6; j++) {
	//          var num = Math.floor(Math.random() * 4) + j * 4;
	//          numArr.push(num);
	//      }
	//      return numArr;
	//  }
	    //随机生成其中黑块的left
	    
	    var ct =0;
	    var last =null;//存储上一个的位置
	    var curr = null;
	    function quleft(){
	    	for( ; ;){
	    		curr = rd(0,3);
	    		if(last != curr){
		    		last = curr;
		    		return curr;
		    	}
	    	}
	    	
	    }
	    //每次调用在图的上方升成一个待往下滚动的大方框，并将其黑色的部分的数字PUSH进locArr中
	    function drawBoard() {
	        var temArr=[];
	        
	        var board = document.createElement('div');
	        board.setAttribute('id', order());
	        board.style.position = "absolute";
	        board.style.width = '100%';
	        board.style.height = '100%';
	        board.style.top = -gameZone.offsetHeight+'px';
	        
	        //随机获取是否出现可长按的条
	        if(cgt && ct<2){
	        	cgt = false;
	        	ct++;
	        	if(isHS){
	        		for(i=0;i<2;i++){
		        		var yxhk = document.createElement('div');
		        		yxhk.setAttribute('class', 'squareBlack');
		        		yxhk.setAttribute('id', 'hei'+i);
		        		yxhk.style.width = gameZone.offsetWidth/4+'px';
		        		yxhk.style.height = gameZone.offsetHeight/5+'px';
		        		yxhk.style.left = arr_left[quleft()]+'px';
	        			yxhk.style.bottom = (gameZone.offsetHeight/5)*i+'px';
		            	board.appendChild(yxhk);
		            	temArr.unshift(i+'');
		            	hkArr.unshift(yxhk);
		        	}
	        		once = true;
		        	var changhei = document.createElement('div');
		        	changhei.setAttribute('class','hei');
		        	changhei.setAttribute('id','chang');
		        	changhei.style.width = gameZone.offsetWidth/4+'px';
		        	changhei.style.height = gameZone.offsetHeight/5*3+'px';
		        	changhei.style.left = arr_left[quleft()]+'px';
		        	changhei.style.bottom = (gameZone.offsetHeight/5)*2+'px';
		        	board.appendChild(changhei);
		        	var zx = document.createElement('div');
		        	zx.setAttribute('class','xian');
		        	zx.style.height = parseInt(changhei.style.height)*0.8+'px';
		        	changhei.appendChild(zx);
		        	var yuan = document.createElement('div');
		        	yuan.setAttribute('class','yuan');
		        	changhei.appendChild(yuan);
		        	yuan.style.width = yuan.style.height = parseInt(changhei.style.height)*0.1+'px';
		        	yuan.style.bottom = parseInt(changhei.style.height)*0.1+'px';
		        	yuan.style.left = parseInt(changhei.style.width)/2-parseInt(changhei.style.height)*0.1/2+'px';
		        	changhei.addEventListener('touchend',()=>{
		        		changhei.removeEventListener('touchend',this);
		        		clearTimeout(tm);
		        	});
		        	var baikuai = document.createElement('div');
					baikuai.setAttribute('id','baikuai');
					changhei.appendChild(baikuai);
					baikuai.style.background= '#3a5a80';
					baikuai.style.position = 'absolute';
//					baikuai.style.opacity = '0.6';
					baikuai.style.width = gameZone.offsetWidth/4+'px';
					baikuai.style.height = (gameZone.offsetHeight/5)*3-20+'px';
					baikuai.style.top = (gameZone.offsetHeight/5)*3+'px';
					
					var banyuan = document.createElement('div');
					baikuai.appendChild(banyuan);
					banyuan.style.background = '#3a5a80';
					banyuan.style.position = 'absolute';
					banyuan.style.width = gameZone.offsetWidth/4+'px';
					banyuan.style.height = '40px';
					banyuan.style.borderRadius = '50%';
					banyuan.style.top = '-20px'
					changhei.style.overflow = "hidden";
					hkArr.unshift(changhei);
	        	}else{
	        		var yxhk = document.createElement('div');
	        		yxhk.setAttribute('class', 'squareBlack');
	        		yxhk.setAttribute('id', 'hei'+6);
	        		yxhk.style.width = gameZone.offsetWidth/4+'px';
	        		yxhk.style.height = gameZone.offsetHeight/3+'px';
	        		if(isdayu) yxhk.style.height = gameZone.offsetHeight/4+'px';
	        		yxhk.style.left = arr_left[quleft()]+'px';
	        		board.appendChild(yxhk);
	        		yxhk.style.bottom = '0px';
	        		temArr.unshift(6+'');
	        		hkArr.unshift(yxhk);
	        		once = true;
	        		var changhei = document.createElement('div');
		        	changhei.setAttribute('class','hei');
		        	changhei.setAttribute('id','chang');
		        	changhei.style.width = gameZone.offsetWidth/4+'px';
		        	changhei.style.height = gameZone.offsetHeight/3*2+'px';
		        	if(isdayu) changhei.style.height = gameZone.offsetHeight/4*3+'px';
		        	changhei.style.left = arr_left[quleft()]+'px';
		        	changhei.style.bottom = gameZone.offsetHeight/3+'px';
		        	board.appendChild(changhei);
		        	var zx = document.createElement('div');
		        	zx.setAttribute('class','xian');
		        	zx.style.height = parseInt(changhei.style.height)*0.8+'px';
		        	changhei.appendChild(zx);
		        	var yuan = document.createElement('div');
		        	yuan.setAttribute('class','yuan');
		        	changhei.appendChild(yuan);
		        	yuan.style.width = yuan.style.height = parseInt(changhei.style.height)*0.1+'px';
		        	yuan.style.bottom = parseInt(changhei.style.height)*0.1+'px';
		        	yuan.style.left = parseInt(changhei.style.width)/2-parseInt(changhei.style.height)*0.1/2+'px';
		        	changhei.addEventListener('touchend',()=>{
		        		changhei.removeEventListener('touchend',this);
		        		clearTimeout(tm);
		        	});
		        	var baikuai = document.createElement('div');
					baikuai.setAttribute('id','baikuai');
					changhei.appendChild(baikuai);
					baikuai.style.background= '#3a5a80';
					baikuai.style.position = 'absolute';
//					baikuai.style.opacity = '0.6';
					baikuai.style.width = parseInt(changhei.style.width)+'px';
					baikuai.style.height = parseInt(changhei.style.height)-20+'px';
					baikuai.style.top = parseInt(changhei.style.height)+'px';
					
					var banyuan = document.createElement('div');
					baikuai.appendChild(banyuan);
					banyuan.style.background = '#3a5a80';
					banyuan.style.position = 'absolute';
					banyuan.style.width = gameZone.offsetWidth/4+'px';
					banyuan.style.height = '40px';
					banyuan.style.borderRadius = '50%';
					banyuan.style.top = '-20px';
					changhei.style.overflow = "hidden";
					hkArr.unshift(changhei);
	        	}
	        	
	        }else{
	        	if(isHS){
	        		for(i=0;i<5;i++){
		        		var yxhk = document.createElement('div');
		        		yxhk.setAttribute('class', 'squareBlack');
		        		yxhk.setAttribute('id', 'hei'+i);
		        		yxhk.style.width = gameZone.offsetWidth/4+'px';
		        		yxhk.style.height = gameZone.offsetHeight/5+'px';
		        		yxhk.style.left = arr_left[quleft()]+'px';
		        		yxhk.style.bottom = (gameZone.offsetHeight/5)*i+'px';
		            	board.appendChild(yxhk);
		            	temArr.unshift(i+'');
		            	hkArr.unshift(yxhk);
		        	}
	        	}else{
	        		var cjgs = 3;
	        		if(isdayu){
	        			cjgs = 4;
	        		}
	        		for(i=0;i<cjgs;i++){
		        		var yxhk = document.createElement('div');
		        		yxhk.setAttribute('class', 'squareBlack');
		        		yxhk.setAttribute('id', 'hei'+i);
		        		yxhk.style.width = gameZone.offsetWidth/4+'px';
		        		yxhk.style.height = gameZone.offsetHeight/cjgs+'px';
		        		yxhk.style.left = arr_left[quleft()]+'px';
		        		yxhk.style.bottom = (gameZone.offsetHeight/cjgs)*i+'px';
		            	board.appendChild(yxhk);
		            	temArr.unshift(i+'');
	//	            	console.log(yxhk)
		            	hkArr.unshift(yxhk);
		        	}
	        	}
	        	
	        }
	        locArr = temArr.concat(locArr);
	        gameZone.appendChild(board);
	    }
	    var tm = null;
		function tcchang(){
			hkArr.pop();
			count += 2;
			wz.innerText = count;
	//		this.removeEventListener('touchstart',tcchang);
			loc+=gameZone.offsetHeight/2;
			tm= setInterval(bainchang,10);
		}
		function over(){
		    changhei.removeEventListener('touchend',over);
			clearTimeout(tm);
		}
	
		function bainchang(){
			var bk = document.getElementById('baikuai');
			var s = parseInt(bk.style.top);
			s-=4;
			bk.style.top = s+'px';
			if(s<=20){
				bk.style.top = 20+'px';
				clearTimeout(tm);
			}
			
		}
	    //找到脚本中存在的两个大方框，使其往下滚动
	    function fall() {
//	    	console.log(loc);
	        gameZone = document.getElementById('gameZone');
	        var boarda = document.getElementById('boarda');
	        var anowtop = parseInt(boarda.style.top);
	        anowtop += 5;
	        boarda.style.top = anowtop + "px";
	        if (anowtop >= gameZone.offsetHeight) {
	            gameZone.removeChild(boarda);
	            boarda = null;
	            drawBoard();
	        }
	        var boardb = document.getElementById('boardb');
	        var bnowtop = parseInt(boardb.style.top);
	        bnowtop += 5;
	        boardb.style.top = bnowtop + "px";
	        if (bnowtop >= gameZone.offsetHeight) {
	            gameZone.removeChild(boardb);
	            boardb = null;
	            drawBoard();
	        }
	        loc -= 5;
	        if (loc <= -10) {
	            clearTimeout(timer);
	            console.log(loc);
	            redk();
	            tis_zd.style.display = 'none';
	            //停止音乐
				bgmc.pause();
				//移除点击监听
	        	document.body.removeEventListener('touchstart',touchbody);
				return;
	        }
	    }
	    
	    //创建失败时的红色框
	    function redk(){
	    	var obj_k = hkArr[hkArr.length-1];
	    	var red_k = document.createElement('div');
	    	red_k.style.width = obj_k.offsetWidth+'px';
	    	red_k.style.height = obj_k.offsetHeight+'px';
	    	red_k.style.background = "#f8635d";
	    	red_k.style.position = 'absolute';
	    	red_k.style.bottom = parseInt(obj_k.style.bottom)+'px';
	    	red_k.style.left = parseInt(obj_k.style.left)+'px';
	    	obj_k.parentElement.appendChild(red_k);
	    	obj_k.parentElement.removeChild(obj_k);
	    	var tmd = 1;
	    	var jj = true;
	    	var js = 0;
	    	var red_tim = setInterval(()=>{
	    		if(jj){
	    			tmd-=0.1;
	    		}else{
	    			tmd+=0.1
	    		}
	    		red_k.style.opacity = tmd;
	    		if(tmd<=0){
	    			jj = false;
	    		}else if(tmd>=1){
	    			jj = true;
	    			js+=1;
	//  			console.log(js)
	    		}
	    		if(tmd>=1&&js==3){
	    			clearTimeout(red_tim);
	//  			console.log(hkArr);
	    			xiaoshi(red_k);
	    			if(isonceagin){
//	    				console.log('点过');
	    				wz.style.display = 'none';
	    				gaof.style.display = 'none';
	    				install.style.display = 'none';
	    				moctim();
	    				gameover();
	    			}else{
//	    				console.log('aaaa')
	    				gameout();
	    			}
	    			
	    		}
	    	},30);
	    }
	    
	//  gameover()
	    //已经点过再来一次,失败时弹出需要下载的页面
	    function gameover(){
	    	
	    	var agover = document.getElementById('agover');
	    	agover.style.top = -agover.parentElement.offsetHeight*0.7+'px';
	    	agover.style.display='block';
	    	if(isHS){
	//  		agover.style.height = '50%';
	    		agover.style.width = '80%';
	    		agover.style.bottom = '10%'
	    	}else{
	    		agover.style.height = '60%';
	    		agover.style.width = '60%';
	    		
	    	}
	    	var ovnum = document.getElementById('ovnum');
	    	ovnum.innerText = 100-count;
	    	agover.style.fontSize = agover.offsetHeight*0.2/2+'px';
	    	agover.children[0].style.lineHeight = agover.children[0].offsetHeight+'px';
	    	agover.children[1].style.top = agover.children[0].offsetHeight+'px';
	    	agover.children[1].style.fontSize= agover.offsetWidth/6+'px';
	    	agover.children[2].style.top = agover.children[0].offsetHeight+agover.children[1].offsetHeight+10 +'px';
//	    	console.log(agover.children[2].children);
	    	agover.children[3].style.left = agover.offsetWidth/2-agover.offsetWidth*0.8/2+'px';
	    	agover.children[3].style.fontSize = agover.offsetWidth*0.8/6+'px';
	    	var bcbk_ag = document.getElementById('bcbk_ag');
	    	bcbk_ag.style.display = 'block';
	    	bcbk_ag.style.width = bcbk_ag.style.height = agover.offsetHeight/2+'px';
	    	bcbk_ag.style.top = "3%";
	    	bcbk_ag.style.left = agover.parentElement.offsetWidth/2-agover.offsetHeight/2/2+'px';
	//  	console.log(agover.parentElement.offsetHeight- agover.parentElement.offsetHeight*0.03-agover.offsetHeight ,agover.offsetTop )
	
	    	var agbtop;
	    	if(isHS){
	    		agbtop= agover.parentElement.offsetHeight- agover.parentElement.offsetHeight*0.1-agover.offsetHeight ;
	    	}else{
	    		agbtop= agover.parentElement.offsetHeight- agover.parentElement.offsetHeight*0.05-agover.offsetHeight ;
	    	}
	    	
	    	var bktop = bcbk_ag.offsetTop;
	    	var tp_ag= -agover.offsetHeight;
	    	var bk_tp = -agover.offsetHeight+tp_ag;
	    	var timover = setInterval(()=>{
	    		tp_ag+=15;
	    		bk_tp+=15;
	    		agover.style.top = tp_ag+'px';
	    		bcbk_ag.style.top = bk_tp+'px';
	    		if(tp_ag>=agbtop){
	    			agover.style.top = agbtop+'px';
	    			bcbk_ag.style.top = bktop+'px';
	    			clearTimeout(timover);
	    			var btn_zsyc = document.getElementById('btn_zsyc');
	    			btn_zsyc.addEventListener('touchstart',userClickedDownloadButton);
	    		}
	    	},10)
	    }
	    
	    //让其他的黑块依次消失
	    function xiaoshi(red_k =null){
	    	var bad = document.getElementById('boardb');
	    	var baa = document.getElementById('boarda');
	    	var hk_cd = 0;
	    	if(red_k){
	    		red_k.style.display = 'none';
	    	}
	    	var hk_jsq = setInterval(()=>{
	    		if(bad.children[hk_cd]){
	    			bad.children[hk_cd].style.display ='none';
	    		}
	    		if(baa.children[hk_cd]){
	    			baa.children[hk_cd].style.display ='none';
	    		}
	    		hk_cd++;
	    		if(hk_cd>=6){
	    			clearTimeout(hk_jsq);
	    		}
	    	},50);
	    }
	
	function onReadyCallback(){
		//无需再监听此事件
		dapi.removeEventListener("ready", onReadyCallback);
		let isAudioEnabled = !!dapi.getAudioVolume();
		if (dapi.isViewable()){
		adVisibleCallback({isViewable:true});
		}
		dapi.addEventListener( "viewableChange" ,adVisibleCallback);
		dapi.addEventListener( "adResized" , adResizeCallback);
		dapi.addEventListener("audioVolumeChange",audioVolumeChangeCallback);
	}
	function adVisibleCallback(event){
		console.log( "isViewable " + event.isViewable);
		if (event.isViewable){
			screenSize = dapi.getScreenSize();
			//启动或恢复广告
		}else {
			//暂停广告并静音
			bgmc.muted = true;
		}
	}
	function adResizeCallback(event){
		screenSize = event;
		console.log("ad was resized width " + event.width +" height " + event.height);
	}
	//当用户点击下载按钮时 - 使用 openStoreUrl 函数
	function userClickedDownloadButton(event){
//		console.log('aaaaa')
		if(dapi.openStoreUrl){
			dapi.openStoreUrl();
		}
		
	} 
	function audioVolumeChangeCallback(volume){
		let isAudioEnabled = !!volume;
		if(isAudioEnabled){
		//打开声音
			bgmc.play();
		}else{
		//关闭声音
			bgmc.pause();
		}
	}

</script>
</body>

</html>
